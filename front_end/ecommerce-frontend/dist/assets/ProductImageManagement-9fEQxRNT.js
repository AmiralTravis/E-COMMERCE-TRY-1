import{_ as ve,P as fe,e as o,h as q,f as X,c as p,o as g,b as I,a as t,p as C,y as b,N as F,F as he,q as be,n as ye,x as _e,d as G,t as xe,g as M,l as r}from"./index-Clrnze2-.js";import{S as Ie,_ as we,r as H,a as J}from"./FileUploadProgress-DuRP7KOC.js";const ke={class:"panel mt-6 main-panel"},Ce={class:"image-management-container"},Fe={class:"product-image-container"},Me={key:0,class:"product-image-preview"},ze=["src","data-full-src"],$e={key:1,class:"upload-prompt"},Pe={class:"flex flex-col items-center justify-center w-full h-full"},Ue={class:"thumbnails-section"},Ne=["src","data-full-src","onClick"],Ve=["onClick"],je={class:"lightbox-content"},Se=["title"],Be={key:0,class:"zoom-hint"},De=["src"],Te={class:"mt-3 text-sm text-gray-500 flex justify-between items-center"},Ae={__name:"ProductImageManagement",props:{modelValue:{type:Array,default:()=>[]}},emits:["update:modelValue"],setup(Ee,{emit:K}){const y=fe(),Q=K,m=o(null),l=o([]),z=o(!1),v=o(0),$=o(null),_=o(!1),c=o(!1),P=o({x:0,y:0});o("@assets/default-thumbnail.jpg");const S=o(null),B=o(null),U=o(null),N=o(!1),h=o(0),D=o(""),T=o(1),V=o(0);q(()=>{var a;return(m.value?1:0)+(((a=l.value)==null?void 0:a.length)||0)});const ee=async()=>{try{if(!y.params.id){l.value=[],m.value=null;return}const a=await M.get(`/admin/products/${y.params.id}`);l.value=a.data.images||a.data.productImages||[],m.value=a.data.mainImage||null}catch(a){console.error("Error loading product images:",a),r.error("Failed to load product images")}};X(async()=>{await ee()});const A=()=>{S.value.click()},ae=async a=>{const e=a.target.files[0];if(e){if(!e.type.startsWith("image/")){r.error("Please upload an image file");return}if(e.size>5*1024*1024){r.error("Image size must be less than 5MB");return}try{const s=new FormData;s.append("image",e);const i=await M.put(`/admin/products/${y.params.id}/main-image`,s,{headers:{"Content-Type":"multipart/form-data"}});m.value={url:i.data.imageUrl},r.success("Main image updated")}catch{r.error("Failed to upload main image")}}},te=()=>{if(l.value.length>=20){r.error("Maximum 20 thumbnails allowed");return}B.value.click()},le=async a=>{var u,f,k,Z,L,R,O;const e=a.target.files;if(!e||e.length===0){r.error("No files selected");return}const s=20-(((u=l.value)==null?void 0:u.length)||0);if(e.length>s){r.error(`You can only upload ${s} more thumbnails`);return}let i=!0;if(Array.from(e).forEach(n=>{n.size>5*1024*1024&&(r.error(`${n.name} exceeds 5MB size limit`),i=!1),n.type.startsWith("image/")||(r.error(`${n.name} is not a valid image file`),i=!1)}),!!i)try{N.value=!0,T.value=e.length,V.value=0;for(let n=0;n<e.length;n++){const x=e[n];D.value=x.name,h.value=0;const W=new FormData;W.append("thumbnails",x);const me=await M.post(`/admin/products/${y.params.id}/thumbnails`,W,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:d=>{const ge=Math.round(d.loaded*100/d.total);h.value=ge/2}});let j=50;const pe=setInterval(()=>{try{j<90&&(j+=1,h.value=j)}catch(d){console.error("Error in setInterval callback: ",d)}},10);await new Promise(d=>setTimeout(d,1e3));const Y=await me.data;clearInterval(pe),Y.success?(h.value=100,l.value=[...l.value,...Y.uploadedImages.map(d=>({id:d.id,url:d.url,thumbnail:d.thumbnail,order:l.value.length}))],V.value+=1):(r.error(`Faild to upload ${x.name}`),h.value=0)}r.success("Thumbnails added successfully")}catch(n){console.error("Upload error:",n);const x=((k=(f=n.response)==null?void 0:f.data)==null?void 0:k.error)||((L=(Z=n.response)==null?void 0:Z.data)==null?void 0:L.details)||"Failed to upload thumbnails, kindly make sure that the file is jpeg, png, or webp format";r.error(((O=(R=n.response)==null?void 0:R.data)==null?void 0:O.details)||x),h.value=0}finally{await new Promise(n=>setTimeout(n,500)),N.value=!1,a.target.value=""}},oe=()=>{c.value=!c.value,c.value||(_.value=!1)},se=a=>{if(!c.value||!$.value)return;const e=$.value.getBoundingClientRect(),s=(a.clientX-e.left)/e.width*100,i=(a.clientY-e.top)/e.height*100;P.value={x:s,y:i},_.value=!0},ne=q(()=>!_.value||!c.value?{}:{transform:"scale(2.5)",transformOrigin:`${P.value.x}% ${P.value.y}%`}),re=()=>{var a;v.value=v.value>0?v.value-1:(((a=l.value)==null?void 0:a.length)||0)-1,w()},ie=()=>{var a;v.value=v.value<(((a=l.value)==null?void 0:a.length)||0)-1?v.value+1:0,w()},w=()=>{c.value=!1,_.value=!1},ue=a=>{v.value=a,z.value=!0,w()},E=()=>{z.value=!1,w()},ce=async a=>{var s;const e=(s=l.value)==null?void 0:s[a];if(!(e!=null&&e.id)){l.value.splice(a,1);return}try{await M.delete(`/admin/products/${y.params.id}/images/${e.id}`),l.value.splice(a,1),r.success("Image removed")}catch{r.error("Failed to remove image")}},de=()=>{m.value=null};return X(()=>{U.value&&l.value&&Ie.create(U.value,{animation:150,filter:'[data-type="add-button"]',preventOnFilter:!1,onMove:function(a){const e=a.related;if(e&&e.getAttribute("data-type")==="add-button")return!1},onEnd:a=>{if(a.oldIndex===a.newIndex)return;const e=[...l.value],[s]=e.splice(a.oldIndex,1);e.splice(a.newIndex,0,s);const i=e.map((u,f)=>({...u,order:f}));l.value=i,Q("update:modelValue",i)}})}),(a,e)=>{var s,i;return g(),p("section",ke,[I(we,{isUploading:N.value,progress:h.value,currentFile:D.value,fileCount:T.value,completedFiles:V.value},null,8,["isUploading","progress","currentFile","fileCount","completedFiles"]),e[3]||(e[3]=t("h2",{class:"section-title text-lg font-semibold mb-4 pb-2 border-b border-gray-200"},"Product Images",-1)),t("div",Ce,[t("div",{class:"main-image-container group",onClick:A},[t("div",Fe,[m.value?(g(),p("div",Me,[t("img",{src:m.value.thumbnail||m.value.url,"data-full-src":m.value.url,alt:"Main product image",class:"product-image"},null,8,ze),t("button",{onClick:b(de,["stop"]),class:"absolute top-2 right-2 bg-white rounded-full p-1 shadow-sm hover:bg-red-50"},[I(F(H),{class:"w-4 h-4 text-red-500"})]),t("button",{onClick:b(A,["stop"]),class:"absolute bottom-2 left-1/2 transform -translate-x-1/2 bg-white px-3 py-1 rounded-full text-sm shadow-sm hover:bg-gray-100"}," Change Image ")])):(g(),p("div",$e,[t("div",Pe,[I(F(J),{class:"w-12 h-12 text-gray-400 mb-2"}),e[1]||(e[1]=t("p",{class:"text-gray-500 text-sm"},"Upload Main Image",-1))])])),t("input",{ref_key:"mainImageInput",ref:S,type:"file",accept:"image/jpeg, image/png, image/webp",class:"hidden",onChange:ae},null,544)])]),t("div",Ue,[t("div",{class:"thumbnails-container",ref_key:"thumbnailsContainer",ref:U},[(g(!0),p(he,null,be(l.value,(u,f)=>(g(),p("div",{key:(u==null?void 0:u.id)||f,class:"thumbnail-container","data-type":"image"},[u?(g(),p("img",{key:0,src:u.thumbnail,"data-full-src":u==null?void 0:u.url,alt:"Product thumbnail",class:"thumbnail-image w-full h-full object-cover",onClick:k=>ue(f)},null,8,Ne)):C("",!0),t("button",{onClick:b(k=>ce(f),["stop"]),class:"absolute top-1 right-1 bg-white rounded-full p-0.5 shadow-sm hover:bg-red-50"},[I(F(H),{class:"w-4 h-4 text-red-500"})],8,Ve)]))),128)),l.value.length<20?(g(),p("div",{key:0,class:"add-image-container","data-type":"add-button",onClick:te},[t("input",{ref_key:"fileInput",ref:B,type:"file",accept:"image/jpeg, image/png, image/webp",multiple:"",class:"hidden",onChange:le},null,544),I(F(J),{class:"w-8 h-8 text-gray-400"})])):C("",!0)],512)])]),z.value?(g(),p("div",{key:0,class:"lightbox",onClick:E},[t("div",je,[t("div",{class:ye(["zoom-container",{"cursor-zoom-in":!c.value,"cursor-zoom-out":c.value}]),onClick:b(oe,["stop"]),onMousemove:se,onMouseleave:e[0]||(e[0]=u=>_.value=!1),title:c.value?"Click to disable zoom":"Click to enable hover-zoom"},[c.value?C("",!0):(g(),p("div",Be,"Click to zoom")),t("img",{src:(s=l.value[v.value])==null?void 0:s.url,alt:"Product image",class:"lightbox-image",ref_key:"lightboxImage",ref:$,style:_e(ne.value)},null,12,De)],42,Se),t("button",{class:"lightbox-close",onClick:b(E,["stop"])},"×"),t("button",{class:"lightbox-nav prev",onClick:b(re,["stop"])},"❮"),t("button",{class:"lightbox-nav next",onClick:b(ie,["stop"])},"❯")])])):C("",!0),t("div",Te,[e[2]||(e[2]=t("span",null,[G("Drag to reorder. Maximum 20 images allowed. "),t("br"),G("Note: Images will be displayed in the order arranged in here. ")],-1)),t("span",null,xe(((i=l.value)==null?void 0:i.length)||0)+"/20 images",1)])])}}},Re=ve(Ae,[["__scopeId","data-v-35aa3069"]]);export{Re as P};
