import{Q as F,g as x,_ as P,e as g,f as W,h as $,c as h,a as t,i as m,d as A,v as C,j as S,k as B,p as y,F as O,q as L,o as v,n as N,t as _,y as f,l as p}from"./index-Clrnze2-.js";const z=F("adminOrderManagement",{state:()=>({orders:[],loading:!1,error:null,socket:null}),actions:{async fetchOrders(){this.loading=!0,this.error=null;try{const r=await x.get("/admin/orders");if(Array.isArray(r.data))this.orders=r.data;else throw new Error("Invalid data format: Orders must be an array")}catch(r){this.error="Failed to fetch orders",console.error("Fetch orders error:",r)}finally{this.loading=!1}},async updateOrderStatus(r,a,d){this.loading=!0,console.log("API Request - Updating order status:",{orderId:r,status:a,estimatedDate:d});try{const u=await x.put(`/admin/orders/${r}/update-status`,{status:a,estimatedDate:d}),i=this.orders.findIndex(c=>c.id===r);return i!==-1&&(this.orders[i]={...this.orders[i],...u.data.order},this.orders=[...this.orders]),u.data}catch(u){throw this.error="Failed to update order status",console.error("Update order status error:",u),u}finally{this.loading=!1}},initializeWebSocket(){const r="ws://localhost:8080";this.socket=new WebSocket(r),this.socket.onopen=()=>{console.log("WebSocket connection established")},this.socket.onmessage=a=>{const d=JSON.parse(a.data);d.type==="order_status_update"&&this.handleOrderStatusUpdate(d)},this.socket.onerror=a=>{console.error("WebSocket error:",a)},this.socket.onclose=()=>{console.log("WebSocket connection closed. Attempting to reconnect..."),setTimeout(()=>this.initializeWebSocket(),5e3)}},handleOrderStatusUpdate(r){const{orderId:a,status:d,estimatedDate:u}=r;if(!this.orders||!Array.isArray(this.orders)){console.error("Orders list is not initialized or invalid.");return}const i=this.orders.findIndex(c=>c.id===a);i!==-1?(this.orders[i]={...this.orders[i],status:d,estimatedDate:u},this.orders=[...this.orders]):console.warn(`Order with ID ${a} not found. Ignoring update.`)}}}),E={class:"orders-dashboard"},H={class:"filters-container"},q={class:"filters"},Q={class:"filter-group"},j={class:"filter-group"},J={class:"filter-group"},R={class:"filter-group"},G={class:"table-container"},K={class:"orders-table"},X={class:"order-id"},Y={class:"user"},Z={class:"total-amount"},tt={class:"status"},et={class:"status-badge"},st={class:"actions"},ot={class:"action-buttons"},at=["onClick"],rt=["onUpdate:modelValue"],it=["onClick"],nt=["onUpdate:modelValue"],lt=["onClick"],dt={key:0,class:"no-results"},ut={__name:"AdminOrderManagament",setup(r){const a=z(),d=g(!0),u=g(!0),i=g(""),c=g("id"),k=g({}),b=g({});W(async()=>{await a.fetchOrders()});const D=$(()=>{let o=a.orders||[];if(i.value){const n=i.value.toLowerCase();o=o.filter(l=>{var U,w;return l.id.toString().includes(n)||((w=(U=l.User)==null?void 0:U.username)==null?void 0:w.toLowerCase().includes(n))})}d.value&&(o=o.filter(n=>n.status!=="Pending")),u.value&&(o=o.filter(n=>n.status!=="Delivered"));const[e,s]=c.value.startsWith("-")?[c.value.slice(1),"desc"]:[c.value,"asc"];return o.sort((n,l)=>s==="asc"?n[e]>l[e]?1:-1:n[e]<l[e]?1:-1)});function M(o){return{Pending:"status-pending",Processing:"status-processing",Shipping:"status-shipping",Delivered:"status-delivered",Cancelled:"status-cancelled"}[o]||""}async function T(o){const e=k.value[o.id];if(!e){p.error("Please select a shipping date");return}try{await a.updateOrderStatus(o.id,"Shipping",e),p.success("Order status updated to Shipping")}catch{p.error("Failed to update order status")}}async function V(o){const e=b.value[o.id];if(!e){p.error("Please select a delivery date and time");return}try{await a.updateOrderStatus(o.id,"Delivering",e),p.success("Order status updated to Delivering")}catch{p.error("Failed to update order status")}}async function I(o){try{await a.updateOrderStatus(o.id,"Delivered"),p.success("Order status updated to Delivered")}catch{p.error("Failed to update order status")}}return(o,e)=>(v(),h("div",E,[e[12]||(e[12]=t("div",{class:"dashboard-header"},[t("h1",{class:"text-center text-2xl font-bold text-gray-800"},"Order Management")],-1)),t("div",H,[t("div",q,[t("div",Q,[t("label",null,[m(t("input",{type:"checkbox","onUpdate:modelValue":e[0]||(e[0]=s=>d.value=s)},null,512),[[C,d.value]]),e[6]||(e[6]=A(" Hide Pending Orders "))])]),t("div",j,[t("label",null,[m(t("input",{type:"checkbox","onUpdate:modelValue":e[1]||(e[1]=s=>u.value=s)},null,512),[[C,u.value]]),e[7]||(e[7]=A(" Hide Delivered Orders "))])]),t("div",J,[e[8]||(e[8]=t("label",null,"Search:",-1)),m(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>i.value=s),placeholder:"Search by Order ID or Username",class:"search-input"},null,512),[[S,i.value]])]),t("div",R,[e[10]||(e[10]=t("label",null,"Sort By:",-1)),m(t("select",{"onUpdate:modelValue":e[3]||(e[3]=s=>c.value=s),class:"sort-select"},e[9]||(e[9]=[t("option",{value:"id"},"Order ID (Asc)",-1),t("option",{value:"-id"},"Order ID (Desc)",-1),t("option",{value:"totalAmount"},"Total Amount (Low to High)",-1),t("option",{value:"-totalAmount"},"Total Amount (High to Low)",-1)]),512),[[B,c.value]])])])]),t("div",G,[t("table",K,[e[11]||(e[11]=t("thead",null,[t("tr",null,[t("th",{class:"order-id"},"Order ID"),t("th",{class:"user"},"User"),t("th",{class:"total-amount"},"Total Amount"),t("th",{class:"status"},"Status"),t("th",{class:"actions"},"Actions")])],-1)),t("tbody",null,[(v(!0),h(O,null,L(D.value,s=>{var n;return v(),h("tr",{key:s.id,class:N(M(s.status))},[t("td",X,_(s.id),1),t("td",Y,_(((n=s.User)==null?void 0:n.username)||"Unknown User"),1),t("td",Z,"$"+_(s.totalAmount.toFixed(2)),1),t("td",tt,[t("span",et,_(s.status),1)]),t("td",st,[t("div",ot,[s.status==="Processing"?(v(),h(O,{key:0},[t("button",{onClick:f(l=>T(s),["stop"]),class:"action-button"}," Update to Shipping ",8,at),m(t("input",{type:"date","onUpdate:modelValue":l=>k.value[s.id]=l,placeholder:"Estimated Shipping Date",class:"date-input",onClick:e[4]||(e[4]=f(()=>{},["stop"]))},null,8,rt),[[S,k.value[s.id]]])],64)):y("",!0),s.status==="Shipping"?(v(),h(O,{key:1},[t("button",{onClick:f(l=>V(s),["stop"]),class:"action-button"}," Update to Delivering ",8,it),m(t("input",{type:"datetime-local","onUpdate:modelValue":l=>b.value[s.id]=l,placeholder:"Exact Delivery Time",class:"date-input",onClick:e[5]||(e[5]=f(()=>{},["stop"]))},null,8,nt),[[S,b.value[s.id]]])],64)):y("",!0),s.status==="Delivering"?(v(),h("button",{key:2,onClick:f(l=>I(s),["stop"]),class:"action-button"}," Update to Delivered ",8,lt)):y("",!0)])])],2)}),128))])]),D.value.length===0?(v(),h("div",dt," No orders found matching your criteria. ")):y("",!0)])]))}},pt=P(ut,[["__scopeId","data-v-4b7ae2a0"]]);export{pt as default};
