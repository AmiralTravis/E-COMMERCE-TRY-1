import{_ as j,e as m,P as Y,h as N,z as V,f as q,g as S,l as f,S as z,A as H,c as y,a as t,C as Q,p as O,i,j as r,v as E,F as $,q as J,s as G,o as p,t as _}from"./index-Clrnze2-.js";import{P as X}from"./ProductImageManagement-9fEQxRNT.js";import"./FileUploadProgress-DuRP7KOC.js";const Z={class:"product-edit-container"},ee={class:"productImage mb-6"},te={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},se={class:"lg:col-span-2 space-y-6"},ae={class:"panel"},oe={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},ne={class:"form-group"},le=["value"],ie={class:"form-group"},ue={class:"form-group"},de={class:"form-group"},re={class:"form-group"},me={class:"form-group"},ce={class:"panel"},pe={class:"space-y-4"},ve={class:"form-group"},ge={class:"form-group"},fe={class:"grid grid-cols-2 gap-4"},ye={class:"form-group"},be={class:"form-group"},De={class:"panel"},he={class:"space-y-4"},ke={class:"flex items-center gap-2"},Pe={class:"flex items-center gap-2"},we={class:"panel"},Se={class:"space-y-4"},xe={class:"form-group"},Ce={class:"grid grid-cols-3 gap-4"},Ve={class:"form-group"},Me={class:"form-group"},Ue={class:"form-group"},Ie={class:"space-y-6"},Ne={class:"panel"},Oe={class:"category-checkboxes space-y-2"},Ee={class:"flex items-center gap-2 p-2 bg-gray-50 rounded"},$e=["id","checked","onChange"],Je=["for"],_e={key:0,class:"subcategories ml-6 mt-1 space-y-2"},We=["id","checked","onChange"],Be=["for"],Fe={__name:"ProductEdit",setup(Re){const h=Y(),W=G(),a=m({name:"",description:"",price:0,discountPercentage:0,costPrice:0,stock:0,images:[],dummyData:{sku:"",trackInventory:!0,continueWhenOutOfStock:!1,weight:0,dimensions:{length:0,width:0,height:0},discountDates:{start:"",end:""}}}),k=m([]),d=m([]),u=m([]),v=m(0),b=m({start:"",end:""});m(!1);const D=m(!1),P=m(null),w=`productDraft-${h.params.id}`,g=N({get:()=>a.value.price,set:o=>{const e=Number(o)||0;if(a.value.price=e,e>0&&v.value>0){const s=(e-v.value)/e*100;a.value.discountPercentage=Math.min(Math.max(s,0),75)}}}),M=N({get:()=>Math.round(a.value.discountPercentage),set:o=>{const e=Math.min(Math.max(Math.round(Number(o)||0),0),75);a.value.discountPercentage=e,v.value=g.value*(1-e/100)}}),B=o=>{const e=Number(o)||0;if(v.value=e,g.value>0){const s=Math.min(Math.max(Math.round((g.value-e)/g.value*100),0),75);a.value.discountPercentage=s}},F=()=>{a.value.dummyData.weight<0&&(f.error("Weight cannot be negative"),a.value.dummyData.weight=0)},x=o=>{const e=a.value.dummyData.dimensions||{};(e[o]||0)<0&&(f.error("Dimensions cannot be negative"),e[o]=0)},U=()=>{if(b.value.start&&b.value.end){const o=new Date(b.value.start),e=new Date(b.value.end);o>e&&(f.error("End date must be after start date"),b.value.end="")}},R=async()=>{var o,e;try{const s={name:a.value.name,description:a.value.description,price:a.value.price,discountPercentage:a.value.discountPercentage,costPrice:a.value.costPrice,stock:a.value.stock,images:a.value.images,categoryIds:[...d.value.map(l=>l.id),...u.value.map(l=>l.id)]};console.log("payload dataa: ",s.images,s.categoryIds),await S.put(`/admin/products/${h.params.id}`,s);const n=await S.get(`/admin/products/${h.params.id}`);a.value={...n.data,dummyData:a.value.dummyData},f.success("Product updated successfully"),P.value=JSON.parse(JSON.stringify({...a.value,dummyData:a.value.dummyData})),D.value=!1}catch(s){console.error("Save error:",s),f.error(((e=(o=s.response)==null?void 0:o.data)==null?void 0:e.error)||"Failed to update product")}},L=()=>{localStorage.removeItem(w),W.push("/admin/manage-products")},A=o=>d.value.some(e=>e.id===o.id),T=o=>u.value.some(e=>e.id===o.id),I=(o,e)=>{if(e)d.value.some(n=>n.id===o.id)?(d.value=d.value.filter(n=>n.id!==o.id),u.value=u.value.filter(n=>!o.children.some(l=>l.id===n.id))):(d.value=[...d.value,o],u.value=[...u.value,...o.children.filter(n=>!u.value.some(l=>l.id===n.id))]);else if(u.value.some(n=>n.id===o.id)){u.value=u.value.filter(l=>l.id!==o.id);const n=k.value.find(l=>{var c;return(c=l.children)==null?void 0:c.some(C=>C.id===o.id)});n&&!n.children.some(l=>u.value.some(c=>c.id===l.id))&&(d.value=d.value.filter(l=>l.id!==n.id))}else{u.value=[...u.value,o];const n=k.value.find(l=>{var c;return(c=l.children)==null?void 0:c.some(C=>C.id===o.id)});n&&!d.value.some(l=>l.id===n.id)&&(d.value=[...d.value,n])}},K=()=>{const o=localStorage.getItem(w);o&&(a.value.dummyData={...a.value.dummyData,...JSON.parse(o)})};return V(()=>({...a.value,dummyData:a.value.dummyData}),o=>{D.value=JSON.stringify(o)!==JSON.stringify(P.value)},{deep:!0}),V(()=>a.value.dummyData,o=>{localStorage.setItem(w,JSON.stringify(o))},{deep:!0}),q(async()=>{window.scrollTo({top:0});try{const[o,e]=await Promise.all([S.get("/products/categories"),S.get(`/admin/products/${h.params.id}`)]);k.value=o.data;const s=e.data;a.value={...a.value,...s,images:s.images||s.productImages||[],price:Number(s.price)||0,discountPercentage:Number(s.discountPercentage)||0,costPrice:Number(s.costPrice)||0},d.value=s.categories.filter(n=>n.isMainCategory).map(n=>({id:n.id,name:n.name,isMain:n.isMainCategory})),u.value=s.categories.filter(n=>!n.isMainCategory).map(n=>({id:n.id,name:n.name,isMain:n.isMainCategory})),v.value=a.value.price*(1-a.value.discountPercentage/100),V(()=>a.value,n=>{D.value=JSON.stringify(n)!==JSON.stringify(P.value)},{deep:!0}),K(),P.value=JSON.parse(JSON.stringify(a.value))}catch(o){console.error("Error loading product:",o),f.error("Failed to load product")}}),z((o,e,s)=>{D.value?window.confirm("You have unsaved changes!")?(localStorage.removeItem(w),s()):s(!1):s()}),window.addEventListener("beforeunload",o=>{D.value&&(o.preventDefault(),o.returnValue="")}),H(()=>{window.removeEventListener("beforeunload",()=>{})}),(o,e)=>(p(),y("div",Z,[e[41]||(e[41]=t("h1",{class:"text-2xl font-bold my-6 pt-2"},"Edit Product",-1)),t("div",ee,[Array.isArray(a.value.images)?(p(),Q(X,{key:0,modelValue:a.value.images,"onUpdate:modelValue":e[0]||(e[0]=s=>a.value.images=s)},null,8,["modelValue"])):O("",!0)]),t("div",te,[t("div",se,[t("section",ae,[e[26]||(e[26]=t("h2",{class:"section-title"},"Pricing & Discount",-1)),t("div",oe,[t("div",ne,[e[20]||(e[20]=t("label",null,"Selling Price",-1)),t("input",{value:v.value.toFixed(2),type:"number",step:"0.01",min:"0",class:"form-input",onInput:e[1]||(e[1]=s=>B(s.target.value)),placeholder:"0.00"},null,40,le)]),t("div",ie,[e[21]||(e[21]=t("label",null,"Original Price",-1)),i(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>g.value=s),type:"number",step:"0.01",min:"0",class:"form-input",placeholder:"0.00"},null,512),[[r,g.value,void 0,{number:!0}]])]),t("div",ue,[e[22]||(e[22]=t("label",null,"Cost Price",-1)),i(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>a.value.costPrice=s),type:"number",step:"0.01",min:"0",class:"form-input",placeholder:"0.00"},null,512),[[r,a.value.costPrice,void 0,{number:!0}]])]),t("div",de,[e[23]||(e[23]=t("label",null,"Discount Percentage",-1)),i(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>M.value=s),type:"number",step:"1",min:"0",max:"75",class:"form-input",placeholder:"0"},null,512),[[r,M.value,void 0,{number:!0}]])]),t("div",re,[e[24]||(e[24]=t("label",null,"Start Date",-1)),i(t("input",{type:"date","onUpdate:modelValue":e[5]||(e[5]=s=>a.value.dummyData.discountDates.start=s),class:"form-input",onChange:U},null,544),[[r,a.value.dummyData.discountDates.start]])]),t("div",me,[e[25]||(e[25]=t("label",null,"End Date",-1)),i(t("input",{type:"date","onUpdate:modelValue":e[6]||(e[6]=s=>a.value.dummyData.discountDates.end=s),class:"form-input",onChange:U},null,544),[[r,a.value.dummyData.discountDates.end]])])])]),t("section",ce,[e[31]||(e[31]=t("h2",{class:"section-title"},"Product Details",-1)),t("div",pe,[t("div",ve,[e[27]||(e[27]=t("label",null,"Product Name",-1)),i(t("input",{"onUpdate:modelValue":e[7]||(e[7]=s=>a.value.name=s),class:"form-input",placeholder:"Enter product name"},null,512),[[r,a.value.name]])]),t("div",ge,[e[28]||(e[28]=t("label",null,"Description",-1)),i(t("textarea",{"onUpdate:modelValue":e[8]||(e[8]=s=>a.value.description=s),rows:"4",class:"form-input",placeholder:"Enter product description"},null,512),[[r,a.value.description]])]),t("div",fe,[t("div",ye,[e[29]||(e[29]=t("label",null,"SKU",-1)),i(t("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>a.value.dummyData.sku=s),class:"form-input",placeholder:"Enter SKU"},null,512),[[r,a.value.dummyData.sku]])]),t("div",be,[e[30]||(e[30]=t("label",null,"Stock Quantity",-1)),i(t("input",{"onUpdate:modelValue":e[10]||(e[10]=s=>a.value.stock=s),type:"number",class:"form-input",placeholder:"Enter stock"},null,512),[[r,a.value.stock,void 0,{number:!0}]])])])])]),t("section",De,[e[34]||(e[34]=t("h2",{class:"section-title"},"Inventory Management",-1)),t("div",he,[t("div",ke,[i(t("input",{"onUpdate:modelValue":e[11]||(e[11]=s=>a.value.dummyData.trackInventory=s),type:"checkbox",id:"trackInventory",class:"w-4 h-4"},null,512),[[E,a.value.dummyData.trackInventory]]),e[32]||(e[32]=t("label",{for:"trackInventory"},"Track inventory for this product",-1))]),t("div",Pe,[i(t("input",{"onUpdate:modelValue":e[12]||(e[12]=s=>a.value.dummyData.continueWhenOutOfStock=s),type:"checkbox",id:"continueSelling",class:"w-4 h-4"},null,512),[[E,a.value.dummyData.continueWhenOutOfStock]]),e[33]||(e[33]=t("label",{for:"continueSelling"},"Continue selling when out of stock",-1))])])]),t("section",we,[e[39]||(e[39]=t("h2",{class:"section-title"},"Shipping Details",-1)),t("div",Se,[t("div",xe,[e[35]||(e[35]=t("label",null,"Weight (kg)",-1)),i(t("input",{"onUpdate:modelValue":e[13]||(e[13]=s=>a.value.dummyData.weight=s),type:"number",step:"0.1",min:"0",max:"1000",class:"form-input",placeholder:"0.0",onChange:F},null,544),[[r,a.value.dummyData.weight,void 0,{number:!0}]])]),t("div",Ce,[t("div",Ve,[e[36]||(e[36]=t("label",null,"Length",-1)),i(t("input",{"onUpdate:modelValue":e[14]||(e[14]=s=>a.value.dummyData.dimensions.length=s),type:"number",min:"0",max:"500",class:"form-input",placeholder:"cm",onChange:e[15]||(e[15]=s=>x("length"))},null,544),[[r,a.value.dummyData.dimensions.length,void 0,{number:!0}]])]),t("div",Me,[e[37]||(e[37]=t("label",null,"Width",-1)),i(t("input",{"onUpdate:modelValue":e[16]||(e[16]=s=>a.value.dummyData.dimensions.width=s),type:"number",min:"0",max:"500",class:"form-input",placeholder:"cm",onChange:e[17]||(e[17]=s=>x("width"))},null,544),[[r,a.value.dummyData.dimensions.width,void 0,{number:!0}]])]),t("div",Ue,[e[38]||(e[38]=t("label",null,"Height",-1)),i(t("input",{"onUpdate:modelValue":e[18]||(e[18]=s=>a.value.dummyData.dimensions.height=s),type:"number",min:"0",max:"500",class:"form-input",placeholder:"cm",onChange:e[19]||(e[19]=s=>x("height"))},null,544),[[r,a.value.dummyData.dimensions.height,void 0,{number:!0}]])])])])])]),t("div",Ie,[t("section",Ne,[e[40]||(e[40]=t("h2",{class:"section-title"},"Categories",-1)),t("div",Oe,[(p(!0),y($,null,J(k.value,s=>(p(),y("div",{key:s.id,class:"category-group"},[t("div",Ee,[t("input",{type:"checkbox",id:`category-${s.id}`,checked:A(s),onChange:n=>I(s,!0),class:"w-4 h-4"},null,40,$e),t("label",{for:`category-${s.id}`,class:"font-medium"},_(s.name),9,Je)]),s.children&&s.children.length?(p(),y("div",_e,[(p(!0),y($,null,J(s.children,n=>(p(),y("div",{key:n.id,class:"flex items-center gap-2"},[t("input",{type:"checkbox",id:`subcategory-${n.id}`,checked:T(n),onChange:l=>I(n,!1),class:"w-4 h-4"},null,40,We),t("label",{for:`subcategory-${n.id}`},_(n.name),9,Be)]))),128))])):O("",!0)]))),128))])])])]),t("div",{class:"sticky bottom-0 bg-white py-4 border-t mt-8 flex justify-end gap-4"},[t("button",{onClick:L,class:"btn-secondary"},"Cancel"),t("button",{onClick:R,class:"btn-primary"},"Save Changes")])]))}},je=j(Fe,[["__scopeId","data-v-591c8b66"]]);export{je as default};
